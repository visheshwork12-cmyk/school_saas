{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "SecretsManagerReadAccess",
      "Effect": "Allow",
      "Action": [
        "secretsmanager:GetSecretValue",
        "secretsmanager:DescribeSecret"
      ],
      "Resource": [
        "arn:aws:secretsmanager:*:*:secret:school-erp/*/*",
        "arn:aws:secretsmanager:*:*:secret:school-erp/*/database*",
        "arn:aws:secretsmanager:*:*:secret:school-erp/*/api*",
        "arn:aws:secretsmanager:*:*:secret:school-erp/*/services*"
      ]
    },
    {
      "Sid": "SecretsManagerListAccess",
      "Effect": "Allow",
      "Action": [
        "secretsmanager:ListSecrets"
      ],
      "Resource": "*",
      "Condition": {
        "StringLike": {
          "secretsmanager:Name": "school-erp/*"
        }
      }
    },
    {
      "Sid": "SecretsManagerApplicationWrite",
      "Effect": "Allow",
      "Action": [
        "secretsmanager:CreateSecret",
        "secretsmanager:UpdateSecret",
        "secretsmanager:PutSecretValue",
        "secretsmanager:TagResource",
        "secretsmanager:UntagResource"
      ],
      "Resource": [
        "arn:aws:secretsmanager:*:*:secret:school-erp/*/api*",
        "arn:aws:secretsmanager:*:*:secret:school-erp/*/services*"
      ],
      "Condition": {
        "StringEquals": {
          "secretsmanager:ResourceTag/Project": "school-erp",
          "secretsmanager:ResourceTag/ManagedBy": "application"
        }
      }
    },
    {
      "Sid": "SecretsManagerRotationAccess",
      "Effect": "Allow",
      "Action": [
        "secretsmanager:RotateSecret",
        "secretsmanager:GetRandomPassword",
        "secretsmanager:UpdateSecretVersionStage"
      ],
      "Resource": [
        "arn:aws:secretsmanager:*:*:secret:school-erp/*/database*"
      ]
    },
    {
      "Sid": "SecretsManagerKMSAccess",
      "Effect": "Allow",
      "Action": [
        "kms:Decrypt",
        "kms:GenerateDataKey",
        "kms:CreateGrant"
      ],
      "Resource": [
        "arn:aws:kms:*:*:key/*"
      ],
      "Condition": {
        "StringEquals": {
          "kms:ViaService": [
            "secretsmanager.*.amazonaws.com"
          ]
        },
        "StringLike": {
          "kms:EncryptionContext:SecretARN": [
            "arn:aws:secretsmanager:*:*:secret:school-erp/*"
          ]
        }
      }
    },
    {
      "Sid": "SecretsManagerLambdaRotation",
      "Effect": "Allow",
      "Action": [
        "lambda:InvokeFunction"
      ],
      "Resource": [
        "arn:aws:lambda:*:*:function:school-erp-*-rotation"
      ],
      "Condition": {
        "StringEquals": {
          "lambda:FunctionTag/Project": "school-erp"
        }
      }
    },
    {
      "Sid": "SecretsManagerVPCAccess",
      "Effect": "Allow",
      "Action": [
        "ec2:CreateNetworkInterface",
        "ec2:DeleteNetworkInterface",
        "ec2:DescribeNetworkInterfaces",
        "ec2:DetachNetworkInterface"
      ],
      "Resource": "*",
      "Condition": {
        "StringEquals": {
          "ec2:ResourceTag/Project": "school-erp"
        }
      }
    }
  ]
}
